---
date: 2025-12-31
lastmod: 2025-12-31
tags:
draft: false
---
## 지연 쓰기(Delayed Write) 메커니즘

1. **변경 감지(Dirty Checking)**
    - 영속성 컨텍스트는 엔티티의 최초 상태를 스냅샷으로 저장해둡니다.
    - 트랜잭션 커밋 시점에 현재 엔티티와 스냅샷을 비교하여 변경된 사항을 감지합니다.
2. **쓰기 지연 SQL 저장소**
    - 엔티티가 변경되거나 새로 저장될 때 바로 SQL을 실행하지 않고, '쓰기 지연 SQL 저장소'에 SQL을 모아둡니다.
```java
@Transactional
public void updateUser(Long id, String newName) {
    User user = userRepository.findById(id).get(); // SQL은 바로 실행됨
    user.setName(newName); // 변경만 감지하고 SQL은 아직 실행되지 않음
} // 메서드 종료 시 트랜잭션 커밋 -> 이때 UPDATE SQL이 실행됨
```
3. **플러시(Flush) 동작**
- 트랜잭션 커밋 시 자동으로 영속성 컨텍스트가 플러시됩니다.
- 플러시는 쓰기 지연 SQL 저장소의 쿼리를 데이터베이스에 전송합니다.
- 명시적으로 플러시를 호출할 수도 있습니다: `entityManager.flush()`